<?xml version="1.0"?>
<!--
Copyright (C) SYSTAP, LLC DBA Blazegraph 2006-2016.  All rights reserved.

Contact:
     SYSTAP, LLC DBA Blazegraph
     2501 Calvert ST NW #106
     Washington, DC 20008
     licenses@blazegraph.com

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; version 2 of the License.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

Copyright 2010 by TalkingTrends (Amsterdam, The Netherlands)
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>com.blazegraph</groupId>
    <artifactId>blazegraph-artifacts</artifactId>
    <version>2.1.5-SNAPSHOT</version>
    <relativePath>../blazegraph-artifacts/pom.xml</relativePath>
  </parent>
  <artifactId>blazegraph-rpm</artifactId>
  <version>2.1.5-SNAPSHOT</version>
  <name>Blazegraph RPM Package</name>
  <description>Blazegraph RPM deployer for the RHEL and CentOS package management systems</description>
  <packaging>rpm</packaging>
  <!--
       Due to https://jira.blazegraph.com/browse/BLZG-1725, you must build with the -P \!signing
       i.e. mvn package -P \!code-signing
  -->
  <properties>
    <rpm.user>blzg</rpm.user>
    <rpm.group>blzg</rpm.group>
    <app.name>blazegraph</app.name>
    <rpm.packageName>blazegraph-${project.version}</rpm.packageName>
    <rpm.installDir>/usr/share/${rpm.packageName}</rpm.installDir>
    <rpm.dataDir>/var/lib/${app.name}</rpm.dataDir>
    <rpm.binDir>/usr/bin</rpm.binDir>
    <rpm.release>SNAPSHOT</rpm.release>
  </properties>
  <build>
    <extensions>
      <extension>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>rpm-maven-plugin</artifactId>
        <version>2.1.5</version>
      </extension>
    </extensions>
    <pluginManagement>
      <plugins>
        <plugin>
          <groupId>org.codehaus.mojo</groupId>
          <artifactId>rpm-maven-plugin</artifactId>
          <version>2.1.5</version>
          <extensions>true</extensions>
          <configuration>
            <license>GPL v2</license>
            <distribution>Blazegraph</distribution>
            <group>High Performance Graph Database</group>
            <packager>SYSTAP, LLC DBA Blazegraph</packager>
            <prefix>${rpm.installDir}</prefix>
            <changelogFile>src/changelog</changelogFile>
            <!-- Note that RPM signing is currently broken on OS-X:  https://github.com/mojohaus/rpm-maven-plugin/issues/11 
            <key>${gpg.keyname}</key>
            <keypath>${gpg.keyring}</keypath>
            <keypassphrase>${gpg.passphrase}</keypassphrase>
            -->
            <mappings>
              <mapping>
                <directory>${rpm.installDir}/lib</directory>
                <filemode>755</filemode>
                <username>root</username>
                <groupname>root</groupname>
                <sources>
                  <source>
                    <location>${project.build.directory}/dependency</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>${rpm.installDir}/war</directory>
                <filemode>755</filemode>
                <recurseDirectories>true</recurseDirectories>
                <username>root</username>
                <groupname>root</groupname>
                <sources>
                  <source>
                    <location>${project.build.directory}/classes/war</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>${rpm.binDir}</directory>
                <filemode>755</filemode>
		<directoryIncluded>false</directoryIncluded>
                <username>${rpm.user}</username>
                <groupname>${rpm.group}</groupname>
                <sources>
                  <source>
                    <location>src/rpm/bin</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>/etc/logrotate.d</directory>
                <configuration>true</configuration>
		<directoryIncluded>false</directoryIncluded>
                <filemode>755</filemode>
                <username>root</username>
                <groupname>root</groupname>
                <sources>
                  <source>
                    <location>src/rpm/logrotate.d/blazegraph</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>/etc/${app.name}</directory>
                <configuration>true</configuration>
                <filemode>755</filemode>
                <username>root</username>
                <groupname>root</groupname>
                <sources>
                  <source>
                    <location>src/rpm/conf</location>
                  </source>
                  <source>
                    <location>${project.build.directory}/classes/RWStore.properties</location>
                  </source>
                  <source>
                    <location>${project.build.directory}/classes/war/WEB-INF/classes/log4j.properties</location>
                  </source>
                  <source>
                    <location>${project.build.directory}/classes/jetty.xml</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>/etc/init.d</directory>
                <configuration>true</configuration>
		<directoryIncluded>false</directoryIncluded>
                <filemode>755</filemode>
                <username>root</username>
                <groupname>root</groupname>
                <sources>
                  <source>
                    <location>src/rpm/init.d</location>
                  </source>
                </sources>
              </mapping>
              <mapping>
                <directory>/usr/share</directory>
                <sources>
                  <softlinkSource>
                    <location>${rpm.installDir}</location>
                    <destination>${app.name}</destination>
                  </softlinkSource>
                </sources>
              </mapping>
            </mappings>
            <preinstallScriptlet>
              <scriptFile>src/rpm/scripts/preinst</scriptFile>
              <fileEncoding>utf-8</fileEncoding>
            </preinstallScriptlet>
            <postinstallScriptlet>
              <scriptFile>src/rpm/scripts/postinst</scriptFile>
              <fileEncoding>utf-8</fileEncoding>
            </postinstallScriptlet>
            <preremoveScriptlet>
              <scriptFile>src/rpm/scripts/preremove</scriptFile>
              <fileEncoding>utf-8</fileEncoding>
            </preremoveScriptlet>
            <postremoveScriptlet>
              <scriptFile>src/rpm/scripts/postremove</scriptFile>
              <fileEncoding>utf-8</fileEncoding>
            </postremoveScriptlet>
            <provides>
              <provide>blazegraph</provide>
            </provides>
            <requires>
              <require>/usr/sbin/useradd</require>
              <require>/usr/bin/getent</require>
            </requires>
          </configuration>
        </plugin>
      </plugins>
    </pluginManagement>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-dependency-plugin</artifactId>
        <version>2.10</version>
        <executions>
          <execution>
            <id>copy</id>
            <phase>compile</phase>
            <goals>
              <goal>copy</goal>
            </goals>
            <configuration>
              <artifactItems>
                <artifactItem>
                  <groupId>com.blazegraph</groupId>
                  <artifactId>embergraph-war-html</artifactId>
                  <version>${project.version}</version>
                  <type>war</type>
                  <overWrite>true</overWrite>
                  <outputDirectory>target/classes/</outputDirectory>
                  <destFileName>blazegraph.war</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>com.blazegraph</groupId>
                  <artifactId>blazegraph-jar</artifactId>
                  <version>${project.version}</version>
                  <type>jar</type>
                  <overWrite>true</overWrite>
                  <outputDirectory>target/classes/</outputDirectory>
                  <destFileName>blazegraph.jar</destFileName>
                </artifactItem>
              </artifactItems>
            </configuration>
          </execution>
          <execution>
            <id>copy-dependencies</id>
            <phase>compile</phase>
            <goals>
              <goal>copy-dependencies</goal>
            </goals>
            <configuration>
              <overWriteReleases>false</overWriteReleases>
              <overWriteSnapshots>false</overWriteSnapshots>
              <overWriteIfNewer>true</overWriteIfNewer>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <artifactId>maven-antrun-plugin</artifactId>
        <version>1.6</version>
        <executions>
          <execution>
            <id>unpack-war</id>
            <goals>
              <goal>run</goal>
            </goals>
            <phase>compile</phase>
            <configuration>
              <target>
                <unzip dest="target/classes/war">
                  <patternset>
                    <include name="**/*"/>
                  </patternset>
                  <fileset dir="target/classes/">
                    <include name="blazegraph.war"/>
                  </fileset>
                </unzip>
                <copy file="target/classes/war/WEB-INF/RWStore.properties" todir="target/classes"/>
                <unzip dest="target/classes/jar">
                  <patternset>
                    <include name="jetty.xml"/>
                  </patternset>
                  <fileset dir="target/classes/">
                    <include name="blazegraph.jar"/>
                  </fileset>
                </unzip>
                <copy file="target/classes/jar/jetty.xml" todir="target/classes"/>
              </target>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
  <reporting>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-javadoc-plugin</artifactId>
        <configuration>
          <stylesheetfile>${basedir}/src/rpm/javadoc/stylesheet.css</stylesheetfile>
          <show>public</show>
          <maxmemory>1000m</maxmemory>
          <author>true</author>
          <version>true</version>
          <doctitle><![CDATA[<h1>Blazegraph RPM</h1>]]></doctitle>
          <bottom><![CDATA[<i>Copyright &#169; 2006-2016 SYSTAP, LLC DBA Blazegraph. All Rights Reserved.</i>
<script>
jQuery(document).ready(function(){
  jQuery('ul.sf-menu').superfish({
  pathClass: 'current',
  cssArrows: false
  });
});

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-50971023-6', 'blazegraph.com');
ga('send', 'pageview');
</script>
]]></bottom>
        </configuration>
      </plugin>
    </plugins>
  </reporting>
  <dependencies>
    <!-- only use the runtime jar here to make it straightforward to upgrade in place -->
    <dependency>
      <groupId>com.blazegraph</groupId>
      <artifactId>embergraph-runtime</artifactId>
      <version>${project.version}</version>
    </dependency>
    <!-- External and third party dependencies -->
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-continuation</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-http</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-io</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-jmx</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-jndi</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-server</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-util</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-webapp</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-servlet</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-security</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-xml</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-rewrite</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-client</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-proxy</artifactId>
      <version>${jetty.version}</version>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <version>${servlet.version}</version>
    </dependency>
    <dependency>
      <groupId>com.github.stephenc.high-scale-lib</groupId>
      <artifactId>high-scale-lib</artifactId>
      <version>${highscalelib.version}</version>
    </dependency>
    <dependency>
      <groupId>com.blazegraph</groupId>
      <artifactId>colt</artifactId>
      <version>${colt.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.lucene</groupId>
      <artifactId>lucene-core</artifactId>
      <version>${lucene.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.lucene</groupId>
      <artifactId>lucene-analyzers-common</artifactId>
      <version>${lucene.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.lucene</groupId>
      <artifactId>lucene-analyzers-smartcn</artifactId>
      <version>${lucene.version}</version>
    </dependency>
    <dependency>
      <groupId>com.ibm.icu</groupId>
      <artifactId>icu4j</artifactId>
      <version>${icu.version}</version>
    </dependency>
    <dependency>
      <!-- log4j is the primary logger for bigdata. -->
      <groupId>log4j</groupId>
      <artifactId>log4j</artifactId>
      <version>${log4j.version}</version>
      <!-- There is a bug with log4j 1.2.15 where it has a lot  -->
      <!-- of dependencies that we do not need in its POM. The  -->
      <!-- exclusions are only necessary with that version.     -->
      <!-- 
           <exclusions>
             <exclusion>
               <groupId>javax.jms</groupId>
               <artifactId>jms</artifactId>
             </exclusion>
             <exclusion>
               <groupId>com.sun.jdmk</groupId>
               <artifactId>jmxtools</artifactId>
             </exclusion>
             <exclusion>
               <groupId>com.sun.jmx</groupId>
               <artifactId>jmxri</artifactId>
             </exclusion>
           </exclusions>
           -->
    </dependency>
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-api</artifactId>
      <version>${slf4j.version}</version>
    </dependency>
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-log4j12</artifactId>
      <version>${slf4j.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpclient</artifactId>
      <version>${apache.httpclient.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpclient-cache</artifactId>
      <version>${apache.httpclient_cache.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpcore</artifactId>
      <version>${apache.httpcore.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpmime</artifactId>
      <version>${apache.httpmime.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-codec</groupId>
      <artifactId>commons-codec</artifactId>
      <version>${apache.commons_codec.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>${apache.commons_fileupload.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
      <version>${apache.commons_io.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-logging</groupId>
      <artifactId>commons-logging</artifactId>
      <version>${apache.commons_logging.version}</version>
    </dependency>
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-core</artifactId>
      <version>${jackson.version}</version>
    </dependency>
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-annotations</artifactId>
      <version>${jackson.version}</version>
    </dependency>
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-databind</artifactId>
      <version>${jackson.version}</version>
    </dependency>
    <dependency>
      <groupId>org.codehaus.jettison</groupId>
      <artifactId>jettison</artifactId>
      <version>${jettison.version}</version>
    </dependency>
    <dependency>
      <groupId>org.openrdf.sesame</groupId>
      <artifactId>sesame-runtime</artifactId>
      <version>${sesame.version}</version>
    </dependency>
    <dependency>
      <groupId>org.openrdf.sesame</groupId>
      <artifactId>sesame-rio-rdfxml</artifactId>
      <version>${sesame.version}</version>
    </dependency>
    <dependency>
      <groupId>org.openrdf.sesame</groupId>
      <artifactId>sesame-queryresultio-sparqljson</artifactId>
      <version>${sesame.version}</version>
    </dependency>
    <dependency>
      <groupId>com.tinkerpop.blueprints</groupId>
      <artifactId>blueprints-core</artifactId>
      <version>${blueprints.version}</version>
    </dependency>
    <dependency>
      <groupId>com.tinkerpop.rexster</groupId>
      <artifactId>rexster-core</artifactId>
      <version>${rexster.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-configuration</groupId>
      <artifactId>commons-configuration</artifactId>
      <version>${apache.commons_configuration.version}</version>
    </dependency>
    <dependency>
      <groupId>it.unimi.dsi</groupId>
      <artifactId>fastutil</artifactId>
      <version>${fastutil.version}</version>
    </dependency>
    <!-- jsonld -->
    <dependency>
      <groupId>com.github.jsonld-java</groupId>
      <artifactId>jsonld-java-sesame</artifactId>
      <version>${jsonld.version}</version>
      <exclusions>
        <exclusion>
          <groupId>org.openrdf.sesame</groupId>
          <artifactId>*</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <!-- Included for RDFa support -->
    <dependency>
      <groupId>org.semarglproject</groupId>
      <artifactId>semargl-sesame</artifactId>
      <version>${semargl.version}</version>
    </dependency>
  </dependencies>
</project>
